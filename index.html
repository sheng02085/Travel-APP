<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Travel App</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        travel: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9',
                            600: '#0284c7',
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        body { overscroll-behavior-y: none; }
        /* ç°¡å–®çš„æ·¡å…¥å‹•ç•« */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 h-screen overflow-hidden flex justify-center">

    <div id="app" class="w-full max-w-md h-full bg-travel-50 flex flex-col relative shadow-2xl overflow-hidden sm:rounded-xl sm:h-[95vh] sm:my-auto">
        
        <header class="bg-white px-6 py-4 shadow-sm z-10 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold text-travel-600">TravelGo</h1>
                <p class="text-xs text-gray-400">æˆ‘çš„è‡ªç”±è¡Œè¦åŠƒ</p>
            </div>
            <button @click="resetAllData" class="text-xs text-red-400 border border-red-200 px-2 py-1 rounded hover:bg-red-50">
                é‡ç½®è³‡æ–™
            </button>
        </header>

        <main class="flex-1 overflow-y-auto hide-scrollbar p-4 pb-24">
            
            <div v-if="currentTab === 'schedule'" class="space-y-4">
                
                <div class="bg-white p-4 rounded-2xl shadow-sm space-y-3 border border-travel-100">
                    <div class="flex justify-between items-center cursor-pointer" @click="showAddSchedule = !showAddSchedule">
                        <h3 class="font-bold text-travel-600"><i class="fa-solid fa-plus-circle mr-1"></i> æ–°å¢è¡Œç¨‹</h3>
                        <i class="fa-solid fa-chevron-down transition-transform" :class="{'rotate-180': showAddSchedule}"></i>
                    </div>
                    
                    <div v-if="showAddSchedule" class="space-y-3 pt-2">
                        <div class="flex gap-2">
                            <select v-model="newSchedule.day" class="bg-gray-50 p-2 rounded-xl text-sm border focus:border-travel-500 outline-none">
                                <option v-for="d in 10" :value="d">ç¬¬ {{ d }} å¤©</option>
                            </select>
                            <input v-model="newSchedule.time" type="time" class="bg-gray-50 p-2 rounded-xl text-sm border focus:border-travel-500 outline-none">
                            <select v-model="newSchedule.weather" class="bg-gray-50 p-2 rounded-xl text-sm border focus:border-travel-500 outline-none">
                                <option value="sunny">â˜€ï¸ æ™´</option>
                                <option value="cloudy">â˜ï¸ é™°</option>
                                <option value="rainy">ğŸŒ§ï¸ é›¨</option>
                            </select>
                        </div>
                        <input v-model="newSchedule.title" placeholder="æ™¯é»åç¨± (ä¾‹å¦‚: æ¸…æ°´å¯º)" class="w-full bg-gray-50 p-2 rounded-xl text-sm border focus:border-travel-500 outline-none">
                        <div class="flex gap-2">
                            <input v-model="newSchedule.location" placeholder="åœ°é»é—œéµå­— (ç”¨æ–¼å°èˆª)" class="flex-1 bg-gray-50 p-2 rounded-xl text-sm border focus:border-travel-500 outline-none">
                            <button @click="addScheduleItem" class="bg-travel-600 text-white px-4 py-2 rounded-xl text-sm font-bold shadow hover:bg-travel-700">æ–°å¢</button>
                        </div>
                    </div>
                </div>

                <div class="flex items-center space-x-2 overflow-x-auto pb-2 scrollbar-hide">
                    <button v-for="day in maxDays" :key="day" 
                        @click="currentDay = day"
                        :class="currentDay === day ? 'bg-travel-500 text-white' : 'bg-white text-gray-500'"
                        class="px-4 py-2 rounded-full text-sm font-medium shadow-sm transition-colors whitespace-nowrap">
                        ç¬¬ {{ day }} å¤©
                    </button>
                </div>

                <div v-if="itineraryDisplay.length === 0" class="text-center py-10 text-gray-400">
                    <i class="fa-solid fa-map-location text-4xl mb-2 opacity-50"></i>
                    <p>é€™å¤©é‚„æ²’æœ‰è¡Œç¨‹ï¼Œå¿«å»æ–°å¢å§ï¼</p>
                </div>

                <div v-for="(item, index) in itineraryDisplay" :key="index" class="relative group">
                    <div class="bg-white p-4 rounded-2xl shadow-sm flex gap-4 border-l-4 border-travel-500">
                        <button @click="deleteSchedule(item.id)" class="absolute top-2 right-2 text-gray-300 hover:text-red-500 p-1">
                            <i class="fa-solid fa-trash-can"></i>
                        </button>

                        <div class="flex flex-col items-center justify-center min-w-[3rem] text-travel-600 font-bold">
                            <span>{{ item.time }}</span>
                            <div class="mt-2 text-yellow-500 text-lg" v-html="getWeatherIcon(item.weather)"></div>
                        </div>
                        <div class="flex-1 pr-6">
                            <h3 class="font-bold text-lg">{{ item.title }}</h3>
                            <p class="text-xs text-gray-400 mt-1"><i class="fa-solid fa-location-dot mr-1"></i> {{ item.location }}</p>
                            <div class="mt-3">
                                <a :href="'https://www.google.com/maps/search/?api=1&query=' + item.location" target="_blank" 
                                   class="inline-block px-3 py-1 bg-travel-50 text-travel-600 text-xs rounded-lg hover:bg-travel-100 transition">
                                    <i class="fa-solid fa-diamond-turn-right mr-1"></i> å°èˆª
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'map'" class="h-full w-full bg-white rounded-2xl shadow-sm overflow-hidden flex flex-col relative">
                 <div class="absolute top-4 left-4 z-10 bg-white/90 px-3 py-1 rounded-lg text-xs shadow text-gray-500">
                    <i class="fa-solid fa-info-circle"></i> é¡¯ç¤ºæ‚¨è¡Œç¨‹ä¸­çš„åœ°é»
                </div>
                <iframe 
                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3640.604692659698!2d120.6864!3d24.0652!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x34693b0000000001%3A0x0!2z5Y-w5Lit5biC6Zu_5bOw5Y2A!5e0!3m2!1szh-TW!2stw!4v1620000000000!5m2!1szh-TW!2stw" 
                    width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy">
                </iframe>
            </div>

            <div v-if="currentTab === 'wallet'" class="space-y-4">
                <div class="bg-gradient-to-r from-travel-500 to-travel-600 text-white p-6 rounded-2xl shadow-lg relative overflow-hidden">
                    <div class="relative z-10">
                        <p class="text-sm opacity-80">ç¸½æ”¯å‡º</p>
                        <h2 class="text-4xl font-bold mt-1">NT$ {{ totalExpense }}</h2>
                    </div>
                    <i class="fa-solid fa-coins absolute -bottom-4 -right-4 text-8xl opacity-20 rotate-12"></i>
                </div>

                <div class="bg-white p-4 rounded-2xl shadow-sm space-y-3">
                    <h3 class="font-bold text-gray-700">æ–°å¢æ”¯å‡º</h3>
                    <div class="flex gap-2">
                        <input v-model="newExpense.name" type="text" placeholder="é …ç›® (ä¾‹å¦‚: æ‹‰éºµ)" class="flex-1 bg-gray-50 p-3 rounded-xl outline-none focus:ring-2 focus:ring-travel-200 transition">
                        <input v-model.number="newExpense.amount" type="number" placeholder="é‡‘é¡" class="w-24 bg-gray-50 p-3 rounded-xl outline-none focus:ring-2 focus:ring-travel-200 transition">
                    </div>
                    <div class="flex gap-2">
                        <select v-model="newExpense.type" class="flex-1 bg-gray-50 p-3 rounded-xl outline-none text-gray-600">
                            <option value="cash">ğŸ’µ ç¾é‡‘</option>
                            <option value="card">ğŸ’³ ä¿¡ç”¨å¡</option>
                        </select>
                        <button @click="addExpense" class="bg-travel-600 text-white px-6 py-2 rounded-xl font-bold shadow-md active:scale-95 transition">
                            <i class="fa-solid fa-plus"></i>
                        </button>
                    </div>
                </div>

                <div v-if="expenses.length === 0" class="text-center py-8 text-gray-300">
                    <p>ç›®å‰æ²’æœ‰æ”¯å‡ºç´€éŒ„</p>
                </div>

                <div class="space-y-2 pb-10">
                    <div v-for="(expense, idx) in expenses" :key="idx" class="bg-white p-3 rounded-xl shadow-sm flex justify-between items-center group relative">
                         <button @click="deleteExpense(idx)" class="absolute -right-2 -top-2 bg-red-500 text-white w-5 h-5 rounded-full text-xs opacity-0 group-hover:opacity-100 transition flex items-center justify-center shadow">
                            <i class="fa-solid fa-times"></i>
                        </button>
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center" 
                                :class="expense.type === 'card' ? 'bg-purple-100 text-purple-600' : 'bg-green-100 text-green-600'">
                                <i :class="expense.type === 'card' ? 'fa-solid fa-credit-card' : 'fa-solid fa-money-bill'"></i>
                            </div>
                            <span class="font-medium text-gray-700">{{ expense.name }}</span>
                        </div>
                        <span class="font-bold text-gray-800">-{{ expense.amount }}</span>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'shop'" class="space-y-4">
                <div class="bg-white p-4 rounded-2xl shadow-sm flex gap-2">
                    <input v-model="newShopItem" @keyup.enter="addShopItem" type="text" placeholder="æƒ³è²·ä»€éº¼ï¼Ÿ" class="flex-1 bg-gray-50 p-3 rounded-xl outline-none focus:ring-2 focus:ring-travel-200 transition">
                    <button @click="addShopItem" class="text-travel-600 font-bold px-4 hover:bg-travel-50 rounded-xl transition">æ–°å¢</button>
                </div>

                <div class="space-y-2">
                    <div v-for="(item, idx) in shopList" :key="idx" class="relative group">
                        <div @click="item.done = !item.done; saveToLocal()"
                            class="bg-white p-4 rounded-xl shadow-sm flex items-center gap-3 transition cursor-pointer select-none"
                            :class="{'opacity-50': item.done}">
                            <div class="w-6 h-6 border-2 rounded-md flex items-center justify-center transition-colors"
                                :class="item.done ? 'bg-travel-500 border-travel-500' : 'border-gray-300'">
                                <i v-if="item.done" class="fa-solid fa-check text-white text-xs"></i>
                            </div>
                            <span :class="{'line-through text-gray-400': item.done}" class="font-medium text-lg">{{ item.name }}</span>
                        </div>
                        <button @click="deleteShopItem(idx)" class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition">
                            <i class="fa-solid fa-trash-can"></i>
                        </button>
                    </div>
                </div>
                 <div v-if="shopList.length === 0" class="text-center py-10 text-gray-400">
                    <i class="fa-solid fa-basket-shopping text-4xl mb-2 opacity-50"></i>
                    <p>æ¸…å–®æ˜¯ç©ºçš„</p>
                </div>
            </div>

        </main>

        <nav class="bg-white border-t px-6 py-2 pb-5 flex justify-between items-center z-10">
            <button @click="currentTab = 'schedule'" :class="currentTab === 'schedule' ? 'text-travel-600' : 'text-gray-300'" class="flex flex-col items-center gap-1 w-12 transition">
                <i class="fa-solid fa-calendar-days text-xl"></i>
                <span class="text-[10px] font-bold">è¡Œç¨‹</span>
            </button>
            <button @click="currentTab = 'map'" :class="currentTab === 'map' ? 'text-travel-600' : 'text-gray-300'" class="flex flex-col items-center gap-1 w-12 transition">
                <i class="fa-solid fa-map-location-dot text-xl"></i>
                <span class="text-[10px] font-bold">åœ°åœ–</span>
            </button>
            <div class="relative -top-5">
                <button @click="currentTab = 'wallet'" class="w-14 h-14 bg-travel-500 rounded-full text-white shadow-lg flex items-center justify-center text-2xl border-4 border-travel-50 active:scale-95 transition">
                    <i class="fa-solid fa-wallet"></i>
                </button>
            </div>
            <button @click="currentTab = 'shop'" :class="currentTab === 'shop' ? 'text-travel-600' : 'text-gray-300'" class="flex flex-col items-center gap-1 w-12 transition">
                <i class="fa-solid fa-bag-shopping text-xl"></i>
                <span class="text-[10px] font-bold">è³¼ç‰©</span>
            </button>
            <button class="text-gray-300 flex flex-col items-center gap-1 w-12 hover:text-gray-400 cursor-not-allowed opacity-50">
                <i class="fa-solid fa-gear text-xl"></i>
                <span class="text-[10px] font-bold">è¨­å®š</span>
            </button>
        </nav>

    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
        const { createApp, ref, computed, watch, onMounted } = Vue;

        createApp({
            setup() {
                const currentTab = ref('schedule');
                const currentDay = ref(1);
                const showAddSchedule = ref(false);

                // --- è³‡æ–™å®šç¾© (æ”¹ç‚ºç©ºé™£åˆ—) ---
                const itineraryData = ref([]);
                const expenses = ref([]);
                const shopList = ref([]);

                // æ–°å¢ç”¨çš„æš«å­˜ç‰©ä»¶
                const newSchedule = ref({ day: 1, time: '10:00', title: '', location: '', weather: 'sunny' });
                const newExpense = ref({ name: '', amount: '', type: 'cash' });
                const newShopItem = ref('');

                // --- LocalStorage å­˜å–åŠŸèƒ½ (æ ¸å¿ƒå‡ç´š) ---
                const saveToLocal = () => {
                    localStorage.setItem('myTravel_itinerary', JSON.stringify(itineraryData.value));
                    localStorage.setItem('myTravel_expenses', JSON.stringify(expenses.value));
                    localStorage.setItem('myTravel_shop', JSON.stringify(shopList.value));
                };

                const loadFromLocal = () => {
                    const savedItinerary = localStorage.getItem('myTravel_itinerary');
                    const savedExpenses = localStorage.getItem('myTravel_expenses');
                    const savedShop = localStorage.getItem('myTravel_shop');

                    if (savedItinerary) itineraryData.value = JSON.parse(savedItinerary);
                    if (savedExpenses) expenses.value = JSON.parse(savedExpenses);
                    if (savedShop) shopList.value = JSON.parse(savedShop);
                };

                // ç•¶ç¶²é è¼‰å…¥æ™‚ï¼Œè®€å–è³‡æ–™
                onMounted(() => {
                    loadFromLocal();
                });

                // --- è¨ˆç®—å±¬æ€§ ---
                // æ ¹æ“šå·²æœ‰çš„è¡Œç¨‹ï¼Œè‡ªå‹•è¨ˆç®—ç¸½å¤©æ•¸ (æœ€å°‘é¡¯ç¤º5å¤©)
                const maxDays = computed(() => {
                    const days = itineraryData.value.map(i => i.day);
                    return Math.max(5, ...days);
                });

                const itineraryDisplay = computed(() => {
                    // æ ¹æ“šæ™‚é–“æ’åº
                    return itineraryData.value
                        .filter(item => item.day === currentDay.value)
                        .sort((a, b) => a.time.localeCompare(b.time));
                });

                const totalExpense = computed(() => {
                    return expenses.value.reduce((sum, item) => sum + item.amount, 0);
                });

                const getWeatherIcon = (weather) => {
                    if (weather === 'sunny') return '<i class="fa-solid fa-sun"></i>';
                    if (weather === 'cloudy') return '<i class="fa-solid fa-cloud"></i>';
                    if (weather === 'rainy') return '<i class="fa-solid fa-umbrella"></i>';
                    return '';
                };

                // --- åŠŸèƒ½å‡½æ•¸ ---

                // æ–°å¢è¡Œç¨‹
                const addScheduleItem = () => {
                    if (newSchedule.value.title && newSchedule.value.location) {
                        itineraryData.value.push({ 
                            id: Date.now(), // çµ¦ä¸€å€‹å”¯ä¸€ ID ç”¨æ–¼åˆªé™¤
                            ...newSchedule.value 
                        });
                        // é‡ç½®è¡¨å–®ä½†ä¿ç•™å¤©æ•¸
                        newSchedule.value.title = '';
                        newSchedule.value.location = '';
                        saveToLocal(); // å„²å­˜
                        showAddSchedule.value = false; // æ”¶èµ·è¡¨å–®
                    }
                };

                // åˆªé™¤è¡Œç¨‹
                const deleteSchedule = (id) => {
                    if(confirm('ç¢ºå®šåˆªé™¤é€™å€‹è¡Œç¨‹å—ï¼Ÿ')) {
                        itineraryData.value = itineraryData.value.filter(item => item.id !== id);
                        saveToLocal();
                    }
                };

                // æ–°å¢æ”¯å‡º
                const addExpense = () => {
                    if (newExpense.value.name && newExpense.value.amount) {
                        expenses.value.unshift({ ...newExpense.value });
                        newExpense.value.name = '';
                        newExpense.value.amount = '';
                        saveToLocal();
                    }
                };

                // åˆªé™¤æ”¯å‡º
                const deleteExpense = (index) => {
                    if(confirm('åˆªé™¤é€™ç­†æ”¯å‡ºï¼Ÿ')) {
                        expenses.value.splice(index, 1);
                        saveToLocal();
                    }
                }

                // æ–°å¢è³¼ç‰©
                const addShopItem = () => {
                    if (newShopItem.value) {
                        shopList.value.unshift({ name: newShopItem.value, done: false });
                        newShopItem.value = '';
                        saveToLocal();
                    }
                };

                // åˆªé™¤è³¼ç‰©
                const deleteShopItem = (index) => {
                     shopList.value.splice(index, 1);
                     saveToLocal();
                }

                // å®Œå…¨é‡ç½® (é™¤éŒ¯ç”¨)
                const resetAllData = () => {
                    if(confirm('è­¦å‘Šï¼šé€™æœƒæ¸…ç©ºæ‰€æœ‰è³‡æ–™ï¼ç¢ºå®šå—ï¼Ÿ')) {
                        itineraryData.value = [];
                        expenses.value = [];
                        shopList.value = [];
                        saveToLocal();
                    }
                }

                return {
                    currentTab, currentDay, maxDays,
                    itineraryDisplay, getWeatherIcon,
                    expenses, newExpense, addExpense, deleteExpense, totalExpense,
                    shopList, newShopItem, addShopItem, deleteShopItem,
                    // æ–°å¢çš„è¡Œç¨‹ç›¸é—œ
                    showAddSchedule, newSchedule, addScheduleItem, deleteSchedule,
                    saveToLocal, resetAllData
                };
            }
        }).mount('#app');
    </script>
</body>
</html>